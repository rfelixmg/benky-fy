<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>{% block title %}Benky-Fy{% endblock %}</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
	<div class="floating-elements">
		<div class="floating-element"></div>
		<div class="floating-element"></div>
		<div class="floating-element"></div>
	</div>

	<header class="header">
		<div class="header-container header-flex">
			<div class="brand">
				<img class="brand-logo" src="{{ url_for('static', filename='img/logo.png') }}" alt="BenkyFY logo" />
				<div class="brand-text">
					<h1 class="main-title">Benky-fy</h1>
					<p class="subtitle">Study Japanese, one card at a time</p>
				</div>
			</div>

			<nav class="nav-links">
				<a href="{{ url_for('main.home') }}">Home</a>
				{% if current_user %}
					<a href="{{ url_for('main.modules') }}">Modules</a>
				{% else %}
					<a href="{{ url_for('auth.login') }}">Login</a>
				{% endif %}
			</nav>

			{% if current_user %}
			<div class="user-chip user-dropdown">
				<div class="user-info">
					<img class="user-avatar" src="{{ current_user.picture }}" alt="{{ current_user.name }} avatar" />
					<div class="user-meta">
						<div class="user-name">{{ current_user.name }}</div>
						<div class="user-sub">basic info</div>
					</div>
				</div>
				<div class="dropdown-menu">
					<a href="#" class="dropdown-item">
						<span>ğŸ‘¤</span>
						Profile
					</a>
					<a href="#" class="dropdown-item">
						<span>ğŸ“Š</span>
						Dashboard
					</a>
					<a href="#" class="dropdown-item">
						<span>âš™ï¸</span>
						Settings
					</a>
					<div class="dropdown-divider"></div>
					<a href="{{ url_for('auth.logout') }}" class="dropdown-item">
						<span>ğŸšª</span>
						Logout
					</a>
				</div>
			</div>
			{% else %}
			<div class="user-chip">
				<div class="user-avatar user-avatar--placeholder">ğŸ‘¤</div>
				<div class="user-meta">
					<div class="user-name">Guest</div>
					<div class="user-sub">not signed in</div>
				</div>
			</div>
			{% endif %}
		</div>
	</header>

	<main class="main-content">
		{% block content %}{% endblock %}
	</main>

	<footer class="footer">
		<div class="footer-text">Benky-Fy Â© 2025</div>
	</footer>

	<script src="{{ url_for('static', filename='js/main.js') }}"></script>
	{% block scripts %}{% endblock %}

	<script>
	// Check for OAuth completion and refresh if needed
	document.addEventListener('DOMContentLoaded', function() {
		// Check if we're coming back from OAuth (URL contains 'authorized')
		if (window.location.pathname.includes('authorized') || 
			window.location.search.includes('code=') ||
			window.location.hash.includes('access_token')) {
			
			// Wait a moment for the server to process the OAuth callback
			setTimeout(function() {
				// Check auth status
				fetch('{{ url_for("auth.check_auth") }}')
					.then(response => response.json())
					.then(data => {
						if (data.authenticated && !{{ 'true' if current_user else 'false' }}) {
							// User is authenticated but page hasn't updated
							window.location.reload();
						}
					})
					.catch(error => {
						console.log('Auth check failed:', error);
					});
			}, 1000); // 1 second delay
		}
	});
	</script>
</body>
</html>


